<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Activity 2 - COI Creation</title>
<style>
  :root {
    --navy: #002b5b;
    --gold: #ffcc00;
  }

  body {
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #002b5b 0%, #0056b3 40%, #ffcc00 100%);
    background-attachment: fixed;
    color: var(--navy);
  }

  body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.35);
    backdrop-filter: blur(2px);
    z-index: -1;
  }

  header {
    background: rgba(0, 43, 91, 0.9);
    color: white;
    display: flex;
    align-items: center;
    padding: 10px 20px;
    width: 100%;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  }

  header img {
    height: 45px;
    margin-right: 10px;
  }

  main {
    background: rgba(255, 255, 255, 0.85);
    border-radius: 10px;
    padding: 25px 40px;
    margin-top: 30px;
    width: 90%;
    max-width: 700px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
  }

  h2 {
    color: var(--navy);
    text-align: center;
  }

  a.download {
    display: inline-block;
    background: var(--navy);
    color: white;
    padding: 10px 15px;
    border-radius: 6px;
    text-decoration: none;
    margin-top: 10px;
    transition: background 0.3s;
  }
  a.download:hover {
    background: #004080;
  }

  form {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  input[type="text"], input[type="email"], input[type="number"], input[type="file"] {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  button {
    background: var(--navy);
    color: white;
    padding: 10px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover {
    background: #004080;
  }

  #result {
    margin-top: 15px;
    text-align: center;
    font-weight: bold;
  }
</style>
</head>
<body>
  <header>
    <img src="https://i.imgur.com/d2BCvGL.png" alt="Office Beacon Logo" />
    <h3>Office Beacon Training - COI Activity 2</h3>
  </header>

  <main>
    <h2>Email Instructions</h2>
    <p><strong>From:</strong> Lorraine Warren (Conjuring Agency)<br>
       <strong>To:</strong> You<br><br>
       Hi <span id="userName">[Name]</span>,<br><br>
       Kindly create a Certificate of Insurance (COI) for Joe Sample‚Äôs policy, listing <strong>Gruber Services</strong> as an Additional Insured.<br><br>
       <strong>Gruber Services</strong><br>
       13 Crystal Lake Rd.<br>
       Friday, CT 58679<br><br>
       Attached is Joe Sample‚Äôs policy Declarations Page for your reference.<br><br>
       ‚Äî Lorraine Warren<br>
       Conjuring Agency<br>
       1313 Annabelle St.<br>
       Valak, CT 58679
    </p>

    <h3>Download Files:</h3>
    <a href="https://drive.google.com/file/d/1EnfKS6UDqdniI1fLl3yP6SymiuAnsffe/view" target="_blank" class="download">üìÑ Download Declarations Page</a><br>
    <a href="https://drive.google.com/file/d/1TSCpP5qPtoBorBqWuzNJMCbzXIjAzGd-/view" target="_blank" class="download">üìù Download ACORD 25 Fillable Form</a>

    <form id="uploadForm">
      <label>Name:</label>
      <input type="text" id="name" name="name" required>

      <label>Email:</label>
      <input type="email" id="email" name="email" required>

      <label>Quiz Score:</label>
      <input type="number" id="quizScore" name="quizScore" readonly>

      <label>Upload your completed PDF:</label>
      <input type="file" id="pdfFile" name="pdfFile" accept="application/pdf" required>

      <button type="submit">Submit Completed PDF</button>
    </form>

    <div id="result"></div>
  </main>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzA178GCCVWV84kd5rEjnzdaU8knSG9MvlndsZVApslylbVUn5KJ3191vGZpsFgE_-t/exec"; // Replace if redeployed

    // Parse query parameters
    function getQueryParams() {
      const params = {};
      window.location.search.substring(1).split("&").forEach(pair => {
        const [key, value] = pair.split("=");
        params[key] = decodeURIComponent(value || "");
      });
      return params;
    }

    window.onload = () => {
      const params = getQueryParams();
      if (params.name) document.getElementById("name").value = params.name;
      if (params.email) document.getElementById("email").value = params.email;
      if (params.quizScore) document.getElementById("quizScore").value = params.quizScore;
      if (params.name) document.getElementById("userName").innerText = params.name;
    };

    document.getElementById("uploadForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const resultDiv = document.getElementById("result");
      resultDiv.textContent = "‚è≥ Uploading... Please wait.";

      const fileInput = document.getElementById("pdfFile");
      const file = fileInput.files[0];
      if (!file) return alert("Please select a PDF file first.");

      const reader = new FileReader();
      reader.onload = async function() {
        const base64Data = reader.result.split(",")[1]; // remove data: prefix
        const payload = {
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          quizScore: document.getElementById("quizScore").value,
          fileName: file.name,
          fileContent: base64Data
        };

        try {
          const res = await fetch(WEB_APP_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if (data.success) {
            resultDiv.innerHTML = `${data.message}<br><a href="${data.fileUrl}" target="_blank">üìÇ View uploaded file</a>`;
          } else {
            resultDiv.textContent = data.message || "‚ùå Upload failed.";
          }
        } catch (err) {
          console.error(err);
          resultDiv.textContent = "‚ùå Network or script error. Please try again.";
        }
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
